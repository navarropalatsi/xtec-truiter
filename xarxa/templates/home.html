{% extends 'base.html' %} {% block content %}

{% load static %}  <!-- Aquesta l√≠nia √©s clau! -->

<!-- Formulari per a crear nou post (nom√©s si l'usuari est√† autenticat) -->
{% if user.is_authenticated %}
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">Nou Truit</h5>
        <form method="post" action="{% url 'create_post' %}">
            {% csrf_token %}
            <textarea
                name="content"
                class="form-control mb-2"
                placeholder="Qu√® est√†s pensant?"
                rows="3"
            ></textarea>
            <button type="submit" class="btn btn-primary">Publicar</button>
        </form>
    </div>
</div>
{% endif %}

<!-- Llista de posts -->
{% for post in posts %}
<div class="card mb-3">
    <div class="card-body">
        <div class="d-flex align-items-center mb-2">
            <img
                src="{{ post.author.profile.profile_picture.url }}"
                onerror="this.onerror=null; this.src='{% static 'profiles/default.jpg' %}'"
                alt="Foto de perfil"
                class="rounded-circle me-2"
                width="40"
                height="40"
            />
            <a
                href="{% url 'profile' post.author.username %}"
                class="text-decoration-none"
            >
                <strong>@{{ post.author.username }}</strong>
            </a>
            <small class="text-muted ms-auto"
                >{{ post.created_at|date:"d/m/Y H:i" }}</small
            >
        </div>
        <p class="card-text">{{ post.content }}</p>
        <div class="d-flex">
            <form method="post" action="{% url 'like_post' post.id %}">
                {% csrf_token %}
                <button
                    type="submit"
                    class="btn btn-sm btn-outline-danger me-2"
                >
                    ‚ù§Ô∏è {{ post.likes.count }}
                </button>
            </form>
            <a href="#" class="btn btn-sm btn-outline-secondary">üí¨ Comentar</a>
        </div>
    </div>
</div>
{% endfor %} {% endblock %}
